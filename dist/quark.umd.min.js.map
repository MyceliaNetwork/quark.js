{"version":3,"file":"quark.umd.min.js","sources":["../src/checkout.ts","../src/initialize.ts"],"sourcesContent":["/**\n * checkout - Open Quark website to confirm checkout\n *\n * After quark.js is properly configured, the integrator\n * can call the `checkout` Function returned by this\n * higher order Function to open a new browser window to\n * the Quark website to let the user confirm the transfer.\n */\n\nimport { type CreateCheckoutArgs, type Checkout, type Basket } from \"./schemas\"\n\nfunction createCheckout({\n  domain,\n  provider,\n  x,\n}: // basket,\n// windowObject,\nCreateCheckoutArgs): Checkout {\n  return function checkout(b: Basket): Basket {\n    // TODO: validate in outside module to separate validation from logic\n    // if (!validateBasket(data)) return\n    console.log(\"ðŸš€ ~ file: checkout.ts:22 ~ checkout ~ b\", b)\n    x.basket = b\n    console.log(\"ðŸš€ ~ file: checkout.ts:23 ~ checkout ~ basket\", x.basket)\n    const queryString = JSON.stringify({\n      origin: window.origin,\n      provider: provider,\n    })\n    x.windowObject = window.open(\n      `${domain}/checkout?data=${btoa(queryString)}`,\n      \"_blank\",\n    )\n    console.log(\n      \"ðŸš€ ~ file: checkout.ts:28 ~ checkout ~ windowObject\",\n      x.windowObject,\n    )\n    return x.basket\n  }\n}\n\nexport { createCheckout }\n","import { createCheckout } from \"./checkout\"\nimport { type Config, type Checkout } from \"./schemas\"\n\nexport function initialize(config: Config): Checkout {\n  // higher order variables that will get assigned upon checkout\n\n  const x = {\n    windowObject: undefined,\n    basket: [],\n  }\n\n  window.addEventListener(\n    \"message\",\n    function (event) {\n      console.log(\"ðŸš€ ~ file: initialize.ts:33 ~ initialize ~ event\", event)\n      if (event.origin !== config.domain) return // DANGER ZONE\n      if (![\"checkoutLoaded\", \"checkoutComplete\"].includes(event.data.type))\n        return\n      if (event.data.type === \"checkoutLoaded\") {\n        const message = JSON.parse(\n          JSON.stringify({\n            type: \"basketUpdate\",\n            origin,\n            basket: x.basket,\n            notify: config.notify,\n            integrator: config.integrator,\n            provider: config.provider,\n          }),\n        )\n        console.log(\n          \"ðŸš€ ~ file: initialize.ts:23 ~ initialize ~ message\",\n          message,\n        )\n        x.windowObject.postMessage(message, config.domain)\n      } else if (event.data.type === \"checkoutComplete\") {\n        config.callback(event.data)\n      }\n    },\n    false,\n  )\n  const { provider, domain } = config\n  return createCheckout({ provider, domain, x })\n}\n"],"names":[],"mappings":";;;;;;IAAA;;;;;;;IAOG;IAIH,SAAS,cAAc,CAAC,EACtB,MAAM,EACN,QAAQ,EACR,CAAC,GAGe,EAAA;QAChB,OAAO,SAAS,QAAQ,CAAC,CAAS,EAAA;;;IAGhC,QAAA,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,CAAC,CAAC,CAAA;IAC1D,QAAA,CAAC,CAAC,MAAM,GAAG,CAAC,CAAA;YACZ,OAAO,CAAC,GAAG,CAAC,+CAA+C,EAAE,CAAC,CAAC,MAAM,CAAC,CAAA;IACtE,QAAA,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC;gBACjC,MAAM,EAAE,MAAM,CAAC,MAAM;IACrB,YAAA,QAAQ,EAAE,QAAQ;IACnB,SAAA,CAAC,CAAA;IACF,QAAA,CAAC,CAAC,YAAY,GAAG,MAAM,CAAC,IAAI,CAC1B,CAAG,EAAA,MAAM,CAAkB,eAAA,EAAA,IAAI,CAAC,WAAW,CAAC,EAAE,EAC9C,QAAQ,CACT,CAAA;YACD,OAAO,CAAC,GAAG,CACT,qDAAqD,EACrD,CAAC,CAAC,YAAY,CACf,CAAA;YACD,OAAO,CAAC,CAAC,MAAM,CAAA;IACjB,KAAC,CAAA;IACH;;ICnCM,SAAU,UAAU,CAAC,MAAc,EAAA;;IAGvC,IAAA,MAAM,CAAC,GAAG;IACR,QAAA,YAAY,EAAE,SAAS;IACvB,QAAA,MAAM,EAAE,EAAE;SACX,CAAA;IAED,IAAA,MAAM,CAAC,gBAAgB,CACrB,SAAS,EACT,UAAU,KAAK,EAAA;IACb,QAAA,OAAO,CAAC,GAAG,CAAC,kDAAkD,EAAE,KAAK,CAAC,CAAA;IACtE,QAAA,IAAI,KAAK,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM;IAAE,YAAA,OAAM;IAC1C,QAAA,IAAI,CAAC,CAAC,gBAAgB,EAAE,kBAAkB,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;gBACnE,OAAM;IACR,QAAA,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,gBAAgB,EAAE;gBACxC,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CACxB,IAAI,CAAC,SAAS,CAAC;IACb,gBAAA,IAAI,EAAE,cAAc;oBACpB,MAAM;oBACN,MAAM,EAAE,CAAC,CAAC,MAAM;oBAChB,MAAM,EAAE,MAAM,CAAC,MAAM;oBACrB,UAAU,EAAE,MAAM,CAAC,UAAU;oBAC7B,QAAQ,EAAE,MAAM,CAAC,QAAQ;IAC1B,aAAA,CAAC,CACH,CAAA;IACD,YAAA,OAAO,CAAC,GAAG,CACT,oDAAoD,EACpD,OAAO,CACR,CAAA;gBACD,CAAC,CAAC,YAAY,CAAC,WAAW,CAAC,OAAO,EAAE,MAAM,CAAC,MAAM,CAAC,CAAA;IACnD,SAAA;IAAM,aAAA,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,kBAAkB,EAAE;IACjD,YAAA,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;IAC5B,SAAA;SACF,EACD,KAAK,CACN,CAAA;IACD,IAAA,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,MAAM,CAAA;QACnC,OAAO,cAAc,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC,CAAA;IAChD;;;;;;;;;;"}