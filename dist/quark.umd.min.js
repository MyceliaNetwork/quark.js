(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
    typeof define === 'function' && define.amd ? define(['exports'], factory) :
    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.quark = {}));
})(this, (function (exports) { 'use strict';

    /**
     * checkout - Open Quark website to confirm checkout
     *
     * After quark.js is properly configured, the integrator
     * can call the `checkout` Function returned by this
     * higher order Function to open a new browser window to
     * the Quark website to let the user confirm the transfer.
     */
    function createCheckout({ provider, domain, windowObject, }) {
        return function checkout(basket) {
            // TODO: validate in outside module to separate validation from logic
            // if (!validateBasket(data)) return
            const queryString = JSON.stringify({
                origin: window.origin,
                provider: provider,
            });
            windowObject = window.open(`${domain}/checkout?data=${btoa(queryString)}`, "_blank");
            return basket;
        };
    }

    let basket = [];
    function initialize(config) {
        const windowObject = window;
        window.addEventListener("message", function (event) {
            if (event.origin !== config.domain)
                return; // DANGER ZONE
            if (!["checkoutLoaded", "checkoutComplete"].includes(event.data.type))
                return;
            if (event.data.type === "checkoutLoaded") {
                const message = JSON.parse(JSON.stringify({
                    type: "basketUpdate",
                    basket,
                    origin,
                    notify: config.notify,
                    integrator: config.integrator,
                    provider: config.provider,
                }));
                windowObject.postMessage(message, config.domain);
            }
            else if (event.data.type === "checkoutComplete") {
                config.callback(event.data);
            }
        }, false);
        const { provider, domain } = config;
        return createCheckout({ provider, domain, windowObject });
    }

    exports.initialize = initialize;

    Object.defineProperty(exports, '__esModule', { value: true });

}));
//# sourceMappingURL=quark.umd.min.js.map
