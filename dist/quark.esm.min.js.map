{"version":3,"file":"quark.esm.min.js","sources":["../src/checkout.ts","../src/initialize.ts"],"sourcesContent":["/**\n * checkout - Open Quark website to confirm checkout\n *\n * After quark.js is properly configured, the integrator\n * can call the `checkout` Function returned by this\n * higher order Function to open a new browser window to\n * the Quark website to let the user confirm the transfer.\n */\n\nimport { type CreateCheckoutArgs, type Checkout, type Basket } from \"./schemas\"\n\nfunction createCheckout({\n  domain,\n  provider,\n  x,\n}: // basket,\n// windowObject,\nCreateCheckoutArgs): Checkout {\n  return function checkout(b: Basket): Basket {\n    // TODO: validate in outside module to separate validation from logic\n    // if (!validateBasket(data)) return\n    console.log(\"ðŸš€ ~ file: checkout.ts:22 ~ checkout ~ b\", b)\n    x.basket = b\n    console.log(\"ðŸš€ ~ file: checkout.ts:23 ~ checkout ~ basket\", x.basket)\n    const queryString = JSON.stringify({\n      origin: window.origin,\n      provider: provider,\n    })\n    x.windowObject = window.open(\n      `${domain}/checkout?data=${btoa(queryString)}`,\n      \"_blank\",\n    )\n    console.log(\n      \"ðŸš€ ~ file: checkout.ts:28 ~ checkout ~ windowObject\",\n      x.windowObject,\n    )\n    return x.basket\n  }\n}\n\nexport { createCheckout }\n","import { createCheckout } from \"./checkout\"\nimport { type Config, type Checkout } from \"./schemas\"\n\nexport function initialize(config: Config): Checkout {\n  // higher order variables that will get assigned upon checkout\n\n  const x = {\n    windowObject: undefined,\n    basket: [],\n  }\n\n  window.addEventListener(\n    \"message\",\n    function (event) {\n      console.log(\"ðŸš€ ~ file: initialize.ts:33 ~ initialize ~ event\", event)\n      if (event.origin !== config.domain) return // DANGER ZONE\n      if (![\"checkoutLoaded\", \"checkoutComplete\"].includes(event.data.type))\n        return\n      if (event.data.type === \"checkoutLoaded\") {\n        const message = JSON.parse(\n          JSON.stringify({\n            type: \"basketUpdate\",\n            origin,\n            basket: x.basket,\n            notify: config.notify,\n            integrator: config.integrator,\n            provider: config.provider,\n          }),\n        )\n        console.log(\n          \"ðŸš€ ~ file: initialize.ts:23 ~ initialize ~ message\",\n          message,\n        )\n        x.windowObject.postMessage(message, config.domain)\n      } else if (event.data.type === \"checkoutComplete\") {\n        config.callback(event.data)\n      }\n    },\n    false,\n  )\n  const { provider, domain } = config\n  return createCheckout({ provider, domain, x })\n}\n"],"names":[],"mappings":"AAAA;;;;;;;AAOG;AAIH,SAAS,cAAc,CAAC,EACtB,MAAM,EACN,QAAQ,EACR,CAAC,GAGe,EAAA;IAChB,OAAO,SAAS,QAAQ,CAAC,CAAS,EAAA;;;AAGhC,QAAA,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,CAAC,CAAC,CAAA;AAC1D,QAAA,CAAC,CAAC,MAAM,GAAG,CAAC,CAAA;QACZ,OAAO,CAAC,GAAG,CAAC,+CAA+C,EAAE,CAAC,CAAC,MAAM,CAAC,CAAA;AACtE,QAAA,MAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC;YACjC,MAAM,EAAE,MAAM,CAAC,MAAM;AACrB,YAAA,QAAQ,EAAE,QAAQ;AACnB,SAAA,CAAC,CAAA;AACF,QAAA,CAAC,CAAC,YAAY,GAAG,MAAM,CAAC,IAAI,CAC1B,CAAG,EAAA,MAAM,CAAkB,eAAA,EAAA,IAAI,CAAC,WAAW,CAAC,EAAE,EAC9C,QAAQ,CACT,CAAA;QACD,OAAO,CAAC,GAAG,CACT,qDAAqD,EACrD,CAAC,CAAC,YAAY,CACf,CAAA;QACD,OAAO,CAAC,CAAC,MAAM,CAAA;AACjB,KAAC,CAAA;AACH;;ACnCM,SAAU,UAAU,CAAC,MAAc,EAAA;;AAGvC,IAAA,MAAM,CAAC,GAAG;AACR,QAAA,YAAY,EAAE,SAAS;AACvB,QAAA,MAAM,EAAE,EAAE;KACX,CAAA;AAED,IAAA,MAAM,CAAC,gBAAgB,CACrB,SAAS,EACT,UAAU,KAAK,EAAA;AACb,QAAA,OAAO,CAAC,GAAG,CAAC,kDAAkD,EAAE,KAAK,CAAC,CAAA;AACtE,QAAA,IAAI,KAAK,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM;AAAE,YAAA,OAAM;AAC1C,QAAA,IAAI,CAAC,CAAC,gBAAgB,EAAE,kBAAkB,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;YACnE,OAAM;AACR,QAAA,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,gBAAgB,EAAE;YACxC,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CACxB,IAAI,CAAC,SAAS,CAAC;AACb,gBAAA,IAAI,EAAE,cAAc;gBACpB,MAAM;gBACN,MAAM,EAAE,CAAC,CAAC,MAAM;gBAChB,MAAM,EAAE,MAAM,CAAC,MAAM;gBACrB,UAAU,EAAE,MAAM,CAAC,UAAU;gBAC7B,QAAQ,EAAE,MAAM,CAAC,QAAQ;AAC1B,aAAA,CAAC,CACH,CAAA;AACD,YAAA,OAAO,CAAC,GAAG,CACT,oDAAoD,EACpD,OAAO,CACR,CAAA;YACD,CAAC,CAAC,YAAY,CAAC,WAAW,CAAC,OAAO,EAAE,MAAM,CAAC,MAAM,CAAC,CAAA;AACnD,SAAA;AAAM,aAAA,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI,KAAK,kBAAkB,EAAE;AACjD,YAAA,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;AAC5B,SAAA;KACF,EACD,KAAK,CACN,CAAA;AACD,IAAA,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,MAAM,CAAA;IACnC,OAAO,cAAc,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC,CAAA;AAChD;;;;"}