/**
 * checkout - Open Quark website to confirm checkout
 *
 * After quark.js is properly configured, the integrator
 * can call the `checkout` Function returned by this
 * higher order Function to open a new browser window to
 * the Quark website to let the user confirm the transfer.
 */
function createCheckout({ provider, domain, windowObject, }) {
    return function checkout(basket) {
        // TODO: validate in outside module to separate validation from logic
        // if (!validateBasket(data)) return
        const queryString = JSON.stringify({
            origin: window.origin,
            provider: provider,
        });
        windowObject = window.open(`${domain}/checkout?data=${btoa(queryString)}`, "_blank");
        return basket;
    };
}

let basket = [];
function initialize(config) {
    const windowObject = window;
    window.addEventListener("message", function (event) {
        if (event.origin !== config.domain)
            return; // DANGER ZONE
        if (!["checkoutLoaded", "checkoutComplete"].includes(event.data.type))
            return;
        if (event.data.type === "checkoutLoaded") {
            const message = JSON.parse(JSON.stringify({
                type: "basketUpdate",
                basket,
                origin,
                notify: config.notify,
                integrator: config.integrator,
                provider: config.provider,
            }));
            windowObject.postMessage(message, config.domain);
        }
        else if (event.data.type === "checkoutComplete") {
            config.callback(event.data);
        }
    }, false);
    const { provider, domain } = config;
    return createCheckout({ provider, domain, windowObject });
}

export { initialize };
//# sourceMappingURL=quark.esm.min.js.map
